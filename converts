SRC=/media/system1/root/CM14/kernel/samsung/smdk4412
#GCC_BIN=/media/system/root/LOS15/prebuilts/gcc/linux-x86/arm/arm-eabi-7.4/bin
#TARGET=arm-linux-gnueabi
#GCC_VER=7.4.1
GCC_VER=4.8
TARGET=arm-eabi
GCC_BIN=/media/system/root/LOS15/prebuilts/gcc/linux-x86/arm/arm-eabi-4.8/bin
GCC="/home/chrono/.bin/ccache $GCC_BIN/${TARGET}-gcc "
OUT_DIR=/media/system1/root/CM14/out/target/product/i9300/obj/KERNEL_OBJ

INFILE=$1
DIRNAME=$(dirname $INFILE)
FILENAME=$(basename $INFILE)
FILENAME_NO_EXT=${FILENAME%.c}


OUT_FILE=${SRC}/${DIRNAME}/${FILENAME_NO_EXT}.S

$GCC -Wp,-MD,${DIRNAME}/.${FILENAME_NO_EXT}.o.d  -nostdinc -isystem ${GCC_BIN}/../lib/gcc/${TARGET}/${GCC_VER}/include \
		-I${SRC}/arch/arm/include -I${OUT_DIR}/arch/arm/include/generated -I${OUT_DIR}/include  -I${SRC}/include \
		-include ${SRC}/include/linux/kconfig.h  -I${SRC}/arch/arm/plat-samsung -I{OUT_DIR}/arch/arm/plat-samsung \
		-I ${SRC}/arch/arm/mach-exynos/include  \
		-D__KERNEL__ \
		-mlittle-endian   -I${SRC}/arch/arm/mach-exynos/include   -I${SRC}/arch/arm/plat-s5p/include   \
		-I${SRC}/arch/arm/plat-samsung/include \
		-Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -Werror-implicit-function-declaration \
		-Wno-format-security -mtune=cortex-a9 -mlong-calls -Wno-error=all -Wno-error=address -Wno-error=declaration-after-statement \
		-Wno-error=enum-compare -Wno-error=return-type -Wno-error=sizeof-pointer-memaccess -Wno-error=strict-prototypes -Wno-error=undef \
		-Wno-error=unused-function -Wno-error=unused-label -Wno-error=unused-parameter -Wno-error=unused-value -Wno-error=unused-variable \
		-O2 -marm -fno-dwarf2-cfi-asm -fstack-protector -fno-ipa-sra -mabi=aapcs-linux -mfpu=vfp -funwind-tables -D__LINUX_ARM_ARCH__=7 \
		-mcpu=cortex-a9 -mtune=cortex-a9 -msoft-float -Uarm -Wframe-larger-than=1024 -Wno-unused-but-set-variable -fomit-frame-pointer \
		-fno-var-tracking-assignments -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fconserve-stack \
		-DCC_HAVE_ASM_GOTO    -D"KBUILD_STR(s)=#s" -D"KBUILD_BASENAME=KBUILD_STR(${FILENAME_NO_EXT})"  \
		-D"KBUILD_MODNAME=KBUILD_STR(${FILENAME_NO_EXT})" -S -c ${SRC}/${INFILE} -o ${OUT_FILE}

test -f ${OUT_FILE} && rm -f ${INFILE} && git add ${OUT_FILE}
